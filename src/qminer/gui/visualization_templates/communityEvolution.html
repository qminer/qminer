<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Community evolution example</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>

    <script type="text/javascript">
        $(function () {
			
            var jqdat = {{{data}}};    //inject data
			var colors = ["#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC","#FF00CC","#66CC33","#FF3333","#000066","#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC","#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00","#3366CC", "#FF00CC", "#66CC33", "#FF3333", "#000066", "#FFCC00", "#3366CC"];

			function edge(n1, n2, w, t0, t1){
				this.n1 = n1;
				this.n2 = n2;
				this.w = w;
				this.t0 = t0;
				this.t1 = t1;
			}
			
			var edges = new Array();
			
			function community(id, size, t, cmty, text){
				this.id = id;
				this.size = size;
				this.t = t;
				this.cmty = cmty;
				this.text = text;
			}
			
			var communities = new Array();
			
			var firstTimePoint = 9007199254740992;
			var lastTimePoint = -9007199254740992;
			var numberOfUniquePoints;
			var uniqueTimePoints = new Array();

				for (var i=0; i<jqdat.edges.length; i++)
					edges.push(new edge(jqdat.edges[i].n1, jqdat.edges[i].n2, jqdat.edges[i].w, jqdat.edges[i].t0, jqdat.edges[i].t1));

				for (var i=0; i<jqdat.communities.length; i++){
					if ($.inArray(jqdat.communities[i].t, uniqueTimePoints)==-1){
						uniqueTimePoints.push(jqdat.communities[i].t);
						communities.push(new Array());
					}
				}
				
				for (var i=0; i<uniqueTimePoints.length; i++){
					for (var j=0; j<jqdat.communities.length; j++){
						if (String(uniqueTimePoints[i]) == String(jqdat.communities[j].t))
							communities[i].push(new community(jqdat.communities[j].id,jqdat.communities[j].size,jqdat.communities[j].t,jqdat.communities[j].cmty, jqdat.communities[j].txt));
						if (jqdat.communities[j].t<firstTimePoint)
							firstTimePoint = jqdat.communities[j].t;
						if (jqdat.communities[j].t>lastTimePoint)
							lastTimePoint = jqdat.communities[j].t;
					}
				}
				
				numberOfUniquePoints = uniqueTimePoints.length;
				var xfactor = 1; 
				//xfactor = numberOfUniquePoints/((lastTimePoint+1) - firstTimePoint);
				
				var uniqueComs = new Array();
				var maxComsInYear = -1;
				var maxSize = -1;
				
				for (var i=0; i<communities.length; i++){
					var br=0;
					for (var j=0; j<communities[i].length; j++){
						if (!$.inArray(communities[i][j].id, uniqueComs))
							uniqueComs.push(communities[i][j].id);
						br++;
						if (communities[i][j].size>maxSize)
							maxSize = communities[i][j].size;
					}
					if (br>maxComsInYear)
						maxComsInYear = br;
					
				}
				
				var verticalSpace = 100;
				var horizontalSpace = 300;
				var sizeScale = 15/Math.log((jqdat.communities.length));
				
				var w;
				w = lastTimePoint + 1 - firstTimePoint;
				if (numberOfUniquePoints > w)
					w = numberOfUniquePoints;
				
				var svg = d3.select("body").append("svg").attr("width", (horizontalSpace)*w).attr("height", horizontalSpace*((jqdat.communities.length)/(uniqueTimePoints.length)));
				var pathsLayer = svg.append('g');
				var circleLayer = svg.append('g');
				

				for (var i=0; i<communities.length; i++){
					for (var j=0; j<communities[i].length; j++){
						circleLayer.append("circle").style("fill", colors[communities[i][j].cmty]).style("fill-opacity",0.4).style("stroke",colors[communities[i][j].cmty]).attr("r", communities[i][j].size*sizeScale).attr("cx", (i*horizontalSpace)+50).attr("cy", (j*verticalSpace)+50).attr("lbl", communities[i][j].id).attr("t", communities[i][j].t)
						.append("title")
						.text(communities[i][j].text);
					}
				}
				
				var entry;
				edges.forEach(function(entry) {
					//console.log("entry.t0: "+entry.t0+" t1: "+ entry.t1+" n1: "+ entry.n1+" n2: "+ entry.n2);
					var t0 = d3.select("[t='" + entry.t0 + "'][lbl='" + entry.n1 + "']");
					var t1 = d3.select("[t='" + entry.t1 + "'][lbl='" + entry.n2 + "']");
					if (t0 != "" && t1 != "" ){
						var t1x = t0.attr("cx");
						var t1y = t0.attr("cy");
						var t2x = t1.attr("cx");
						var t2y = t1.attr("cy");
						var color = t0.style("fill");
						var width = entry.w*sizeScale;
						var angl = parseInt(180) + parseInt((i*270)%360);
						var tx = parseInt(t1x)+parseInt((t2x-t1x)/2);
						pathsLayer.append("path").attr("d","M"+t1x+","+t1y+"C"+tx+","+t1y+" "+tx+","+t2y+" "+t2x+","+t2y).style("stroke-width", width).style("stroke",color).style("stroke-opacity","0.4444444").style("stroke-linecap","round").style("fill","none");
					}
				});
			});	
	
    </script>
</head>
<body>
</body>
</html>